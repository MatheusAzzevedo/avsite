<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurações da Conta</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; }
        
        .navbar { background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); padding: 1rem 2rem; display: flex; gap: 2rem; }
        .navbar a { text-decoration: none; color: #333; }
        .container { max-width: 600px; margin: 2rem auto; padding: 0 1rem; }
        .card { background: white; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); padding: 2rem; margin-bottom: 2rem; }
        
        h1 { color: #333; margin-bottom: 2rem; }
        h2 { color: #EA580C; font-size: 1.2rem; margin-bottom: 1rem; }
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; }
        .form-group input { width: 100%; padding: 0.75rem; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; }
        .btn { padding: 0.75rem 1.5rem; background: #EA580C; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; }
        .btn:hover { background: #C2410C; }
        .success { background: #d1fae5; color: #065f46; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; display: none; }
        .success.show { display: block; }
    </style>
</head>
<body>
    <div class="navbar">
        <a href="dashboard.html"><i class="fas fa-home"></i> Início</a>
        <a href="pedidos.html"><i class="fas fa-list"></i> Pedidos</a>
        <a href="configuracoes.html"><i class="fas fa-cog"></i> Configurações</a>
    </div>

    <div class="container">
        <h1><i class="fas fa-cog"></i> Configurações da Conta</h1>
        
        <div class="card">
            <h2>Meus Dados</h2>
            <div id="successMessage" class="success"></div>
            <form id="profileForm">
                <div class="form-group">
                    <label>Nome</label>
                    <input type="text" id="nome" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="email" disabled style="background: #f5f5f5;">
                </div>
                <div class="form-group">
                    <label>Telefone</label>
                    <input type="tel" id="telefone">
                </div>
                <button type="submit" class="btn"><i class="fas fa-save"></i> Salvar Alterações</button>
            </form>
        </div>
    </div>

    <script src="js/auth-manager.js"></script>
    <script>
        (async () => {
            await clienteAuth.requireAuth();
            
            try {
                const response = await clienteAuth.fetchAuth('/cliente/auth/me');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('nome').value = data.data.nome;
                    document.getElementById('email').value = data.data.email;
                    document.getElementById('telefone').value = data.data.telefone || '';
                }
            } catch (error) {
                console.error('Erro:', error);
            }
        })();

        document.getElementById('profileForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const dados = {
                nome: document.getElementById('nome').value.trim(),
                telefone: document.getElementById('telefone').value.trim() || undefined
            };

            try {
                const response = await clienteAuth.fetchAuth('/cliente/auth/profile', {
                    method: 'PUT',
                    body: JSON.stringify(dados)
                });

                const data = await response.json();

                if (response.ok) {
                    const successDiv = document.getElementById('successMessage');
                    successDiv.textContent = 'Dados atualizados com sucesso!';
                    successDiv.classList.add('show');
                    setTimeout(() => successDiv.classList.remove('show'), 3000);
                    
                    // Atualiza dados locais
                    const cliente = clienteAuth.getCliente();
                    clienteAuth.saveAuth(clienteAuth.getToken(), { ...cliente, ...data.data });
                } else {
                    alert(data.error || 'Erro ao atualizar dados');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao atualizar dados');
            }
        });
    </script>
</body>
</html>
